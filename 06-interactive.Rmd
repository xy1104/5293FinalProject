# Interactive component

```{r}
library(tidyverse)
library(ggplot2)
library(plotly)
```

```{r}
# imdb
movie_IMDB = read_csv("movie_IMDB.csv")
movie_high= read_csv("movie_high.csv")
movie_median= read_csv("movie_median.csv")
movie_low= read_csv("movie_low.csv")
movie_douban = rbind(movie_high,movie_median)
movie_douban = rbind(movie_douban,movie_low)
#head(movie_douban)
#head(movie_IMDB)
```

## Genre Changes over Time
### IMDB
```{r}
# split the genre column into three new columns: genre_1, genre_2, genre_3, note, some movies do not have value in genre_2 or genre_3
movie_IMDB_split_genre <- movie_IMDB %>%
  separate(genre, c("genre_1", "genre_2", "genre_3"))

#head(movie_IMDB_split_genre)

# we also need a tibble that with one column genre but store one genre in each row
movie_IMDB_split_mutirows <- movie_IMDB_split_genre %>%
  pivot_longer(genre_1:genre_3, names_to = "genre_order", values_to = "genre_i") %>%
  drop_na() %>%
  filter(genre_i != "Fi")

#head(movie_IMDB_split_mutirows)

# find the top 10 favorite genres
movie_genre_top10 <- movie_IMDB_split_mutirows %>%
  group_by(genre_i) %>%
  summarise(total_counts = n()) %>%
  arrange(-total_counts) %>% 
  top_n(10)

#movie_genre_top10


# view the trend of top 10 genres by year
movie_genre_top10_by_year <- left_join(movie_IMDB_split_mutirows,movie_genre_top10, by = "genre_i") %>%
  drop_na() %>%
  group_by(year, genre_i) %>%
  summarize(quantity = n())

#movie_genre_top10_by_year
# find the top

fig <- movie_genre_top10_by_year %>%
  ungroup() %>%
  plot_ly(x = ~year, y = ~quantity, color = ~genre_i, type = 'scatter',  mode = 'lines+markers', line = list(width = 1)) %>%
  layout(title = "Trends of Top 10 Genres from 1920 to 2022(IMDB)",
         yaxis = list(title = "Quantities of Genres per year"),
         xaxis = list(title = "Year"))


fig

```

**Interactive line plot instructions** \
*a. Move your mouse to each points will show out the genre, the Year,and the total count of this genre in this year* \
*b. Click the legend you wand to disappear or appear the data for the genres*


**Infer** \
From this interactive lines plot on Trends of Top 10 Genres from 1920 to 2022(IMDB), we also derived that that: \
1. Drama seems to be the most popular genre. \
2. Compared with other film genres, the number of Drama in the top 700 list is several times or even a dozen times higher than other genres almost every year. \
3. In the top 700 list, each genre occupies in the range of [0,18] in each year. \
4. The number of films in all genres changed little before 1960, but grew dramatically from the 1990s onward, with significant growth in the number of films in the top five categories of Drama, Comedy, Thriller, Adventure, and Romance. After peaking around 2010, the number of movies has declined overall in recent years.


### Douban
```{r}
# split the genre column into three new columns: genre_1, genre_2, genre_3, note, some movies do not have value in genre_2 or genre_3
movie_DB_split_genre <- movie_douban %>%
  separate(Type, c("genre_1", "genre_2", "genre_3"))

#head(movie_DB_split_genre)

# we also need a tibble that with one column genre but store one genre in each row
movie_DB_split_mutirows <- movie_DB_split_genre %>%
  pivot_longer(genre_1:genre_3, names_to = "genre_order", values_to = "genre_i") %>%
  drop_na()

#head(movie_DB_split_mutirows)

# find the top 10 favorite genres
movie_genre_top10 <- movie_DB_split_mutirows %>%
  group_by(genre_i) %>%
  summarise(total_counts = n()) %>%
  arrange(-total_counts) %>% 
  top_n(10)

#movie_genre_top10


# view the trend of top 10 genres by year
movie_genre_top10_by_year <- left_join(movie_DB_split_mutirows,movie_genre_top10, by = "genre_i") %>%
  drop_na() %>%
  group_by(Year, genre_i) %>%
  summarize(quantity = n())

#movie_genre_top10_by_year
# find the top

fig <- movie_genre_top10_by_year %>%
  ungroup() %>%
  plot_ly(x = ~Year, y = ~quantity, color = ~genre_i, type = 'scatter',  mode = 'lines+markers', line = list(width = 1)) %>%
  layout(title = "Trends of Top 10 Genres from 1920 to 2022 (Douban)",
         yaxis = list(title = "Quantities of Genres per year"),
         xaxis = list(title = "Year"))


fig

```

**Interactive line plot instructions** \
*a. Move your mouse to each points will show out the genre, the Year,and the total count of this genre in this year* \
*b. Click the legend you wand to disappear or appear the data for the genres*


**Infer** \
From this interactive lines plot on Trends of Top 10 Genres from 1920 to 2022 (Douban), **we could select different genres to make them hidden or appear**, we also derived that that: \
1. For both website, Drama is the mainly genre in the movie market in every year. Thie may because some movies would have more than one genre, and Drama would be the most recapitulative type. \
2. There are some difference genres of the top 10 genre, however, most of them are the same. \
3. We can see that these genres increase withn fluctuation, and there is a rapid drop during the 2019-2020, because of the epidemic, the movie market is almost at standstill. \


## Significant difference: Scatter plot
Since the size of datasets are not same, we find the same movies contained in both dataset. The scatter plot would give a more intuitional result. X-axis is rating from Douban (doubanR), Y-axis is rating from IMDB (imdbR), the short blue is the regression line between them and abline(black straight line). Above black line, doubanR < imdbR, and below black line, doubanR > imdbR. 
```{r}
set.seed(0)


names = as.vector(intersect(movie_douban$Name,movie_IMDB$movie_title))
#length(names)
db=tibble(doubanR=movie_douban[which(movie_douban$Name %in% names, arr.ind=TRUE),]$Rank,
            name=movie_douban[which(movie_douban$Name %in% names, arr.ind=TRUE),]$Name)
#db
imdb=tibble(imdbR=movie_IMDB[which(movie_IMDB$movie_title %in% names, arr.ind=TRUE),]$rating,
            name=movie_IMDB[which(movie_IMDB$movie_title %in% names, arr.ind=TRUE),]$movie_title)
#imdb

combo =left_join(imdb,db) 
#combo
scatter <- ggplot( data=combo,
              aes(x = doubanR, 
                  y = imdbR,
                  label = name))+
  geom_point(color="firebrick", alpha=0.5) +
  geom_abline() +
  stat_smooth(method = "lm",se=FALSE)+
  xlim(7,10) +
  ylim(7,10)+
  labs(
    title = "Rating in IMDB and Douban"
  )

ggplotly(scatter)
```

**Interactive plot instructions** \
*a. Move your mouse to each points will show out the name of movie, and its rating on both IMDB and Douban* \
*b. Move your mouse on the blue line will tell you the position on the doubanR-imdbR coordinate within the range exists data points*

**Infer** \
From this interactive plot, you could see the details by moving mouse over the point, we could find that: \
1. There exists a linear relationship between rating of Douban and rating of IMDB Usually, if one rating is high, the other would also have a high rating. Hence, even rating is a very personal thing, however, with the large amount users of Douban and IMDB, the popularity of rating is similar, no matter in CHina or in America. \
2. Since our data only contain the rating > 7, thus, for these high rating movies, the Douban always has a higher score than IMDB. This is because the scoring mechanism is differentï¼Œ\
  * IMDB: 10 stars \
  * Douban: 5 stars \
for a good movie, it is hard to give 10/10, 8/10 maybe already consider as a high score. On the other hand, 4/5, or 5/5 could be easy on Douban.

## Significant difference: Percentile plot
To reduce the effect of scoring mechanism, we use percentile rank (the below interactive plot), thus we rank movies by IMDB and Douban respectively, the highest rating is 100, and the lowest is 0, we redraw the plor. The points located between two grey lines (the rank difference is less than 20%) can be regarded as having a small score difference between IMDB and Douban.

```{r}
combo1 = combo %>%
  arrange(imdbR) %>%
  mutate(imdbP = row_number(),
         imdbPR = round(imdbP/253 *100))%>%
  arrange(doubanR) %>%
  mutate(doubanP = row_number(),
         doubanPR = round(doubanP/253*100))
#combo1
percentile <- ggplot( data=combo1,
              aes(x = doubanPR, 
                  y = imdbPR,
                  label = name))+
  geom_point(color="lightblue") +
  geom_abline() +
  geom_abline(intercept = 20, alpha = 0.5) +
  geom_abline(intercept = -20,alpha = 0.5) +
  stat_smooth(method = "lm",se=FALSE)+
  xlim(0,100)+
  ylim(0,100)+
  labs(
    title = "Rating in IMDB and Douban(percentile rank)"
  )

ggplotly(percentile)
```

**Interactive plot instructions** \
*a. Move your mouse to each points will show out the name of movie, and its percentile rank on both IMDB and Douban* \
*b. Move your mouse on the blue line will tell you the position on the doubanR-imdbR coordinate within the range exists data points* \
*c. Move your mouse on the grey lines will tell you its slope and intercept.*


**Infer** \
We could observe that (you could see the details by moving mouse over the point): \
1. The positive relation still exists, the regression line changes slightly. \
2. However, from the regression lines, the rating on two website are similar, there still have some movies, above the top grey line and below the bottom grey line, which have a big difference between two websites, which may cause by the culture, regulations, or other reasons.

